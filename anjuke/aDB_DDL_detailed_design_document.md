#  详细设计文档

## 编写目的
当前的DBRT处理都是在现有的缺陷管理系统ibug系统中提交的，与其他类型的缺陷共用一套管理方式，然而ibug的审批流程比较繁琐，提交规范很难控制，执行过程没有有效的监督和记录，不满足像DBRT这样需要严格把控审核的需求。
因此我们需要将DBRT功能从ibug系统中独立拆分出来，并与开发人员的项目开发、测试、发布的流程相结合，设计并开发一个适用于安居客环境中的DBRT系统。
此文档的作用在简要设计文档基础上，不仅介绍我们将要开发的系统的功能和设计，也会对每个模块进行更详细的设计和描述，为后续的开发提供一个可以作为指导的详细设计文档。

## 功能描述
adb DBRT系统是一个减轻DBA线上操作负担，便于开发人员使用的一个自助操作的系统，它是传统的人工DBRT审核执行过程的升级版，将审核、审批、执行的过程融合为一体，能够随时提供自助的DBRT服务。

## 设计描述
逻辑结构：

物理结构：

### 系统角色说明：

* 用户
	* 有DDL需求的开发人员，可以提出相应的建库、建表、改表等需求
* 自动审核程序
	* 对DDL需求进行词法、语法、规范的审核
* 业务DBA
	* 对DDL需求进行业务层的审核
* 开发经理
	* 对DDL需求进行业务权限的审核
* DB部门DBA
	* 对DDL需求进行数据库性能层面的审核
* PG环境执行器
	* 在测试环境中执行DBRT的任务执行模块
* QA
	* 测试人员，对DBRT需求是否符合测试环境下的测试结果进行判断
* 线上环境执行器
	* 在线上环境下执行DBRT的任务执行模块


## 功能描述
### DBRT审批功能
* DBRT工单需要经过业务DBA、开发经理的业务审核，QA的测试环境检测、DBA的线上执行预检,最后才会在固定时刻由定时执行器在线上执行。
* 审批步骤：自动审核->业务DBA->开发经理->QA->DB部门DBA, 审批通过的就会交由定时执行程序在一个固定的时间段执行。
（此处一张流程图）
流程中一些细节、原则。。。。。

### DDL的规范检查功能：
* 用户在提交DDL时，系统会检查DDL的每一项规范，如果不满足则不允许提交。
	
### 定时执行DDL任务功能：
* 经过层层审核的DBRT任务会交由定时任务执行模块执行，执行结果需要用户自己去查看并确认才算结束。

### 索引自动生成功能：
* 根据用户提供的查询SQL，判断其是否能使用到现有索引，如果使用不上则给出一个建议的索引创建语句。

## 架构描述
前端浏览器+后端python及django框架+MySQL数据库+Inception审核服务器


## 设计描述
前端使用AngularJS开发，后端使用Python+Django+Celery，审核服务器使用Inception，数据库使用MySQL


## 模块设计描述